<div class="container-fluid">
  <div class="row start-xs">
    <div class="col-xs">
      <a [routerLink]="['/administration/sites']"
      >{{ "administration.site.buttons.back" | translate }}
      </a>
    </div>
  </div>
  <div *ngIf="paramId" class="col-xs-12 col-md start-xs">
    <h1 translate="administration.site.title.edit"></h1>
  </div>
  <div *ngIf="!paramId" class="col-xs-12 col-md start-xs">
    <h1 translate="administration.site.title.new"></h1>
  </div>
  <form [formGroup]="Deploy">
    <div class="row">
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.name.label" required></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="name" >
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId" >
          <input  matInput formControlName="name">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.number.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="number">
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="number">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.group.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="group">
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="group">
        </mat-form-field>
      </div>
      <div class="form-group col-sm-6 col-xs-12" *ngIf="paramId ">
        <label translate="administration.site.fields.category.label"></label>
        <mat-form-field class="full-width">
          <mat-select formControlName="option" >
            <mat-option *ngFor="let list of categoryLk" [value]="list.value">
              {{list.text}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="form-group col-sm-6 col-xs-12" *ngIf="!paramId">
        <label translate="administration.site.fields.category.label"></label>
        <mat-form-field class="full-width">
          <mat-select formControlName="option" >
            <mat-option *ngFor="let list of categoryLk" [value]="list.value">
              {{list.text}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <!--- google location -->
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.address.label" required></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input (input)="onSearchChange()"
          #locality matInput formControlName="address">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input (input)="onSearchChange()"
          #locality matInput formControlName="address">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.addressaddition.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="addressaddition">
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="addressaddition">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="form-group col-sm-3 col-xs-12">
        <label translate="administration.site.fields.zip.label" required></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="zip">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="zip">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
      <div class="form-group col-sm-3 col-xs-12" >
        <label translate="administration.site.fields.city.label" required></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="city">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="city">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
      <div class="form-group col-sm-3 col-xs-12">
        <label translate="administration.site.fields.country.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="country">
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="country">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.phone.label" required></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="phone">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="phone">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.fax.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="fax">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="fax">
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="form-group col-sm-6 col-xs-12">
        <label translate="administration.site.fields.email.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="email" >
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="email" >
          <mat-error >{{'form.errors.required' | translate}}</mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <h4 translate="administration.site.section.tender-preset"></h4>
      </div>
    </div>
    <div class="row">
      <div class="form-group col-sm-3 col-xs-12">
        <label translate="administration.site.fields.zip_min.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="zip_min">
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="zip_min">
        </mat-form-field>
      </div>
      <div class="form-group col-sm-3 col-xs-12">
        <label translate="administration.site.fields.zip_max.label"></label>
        <mat-form-field class="full-width" *ngIf="paramId">
          <input matInput  formControlName="zip_max">
        </mat-form-field>
        <mat-form-field class="full-width" *ngIf="!paramId">
          <input matInput formControlName="zip_max">
        </mat-form-field>
      </div>
    </div>
      <div *ngIf="showContact" formGroupName="contact">
        <h3 class="col-xs-12">{{'administration.client.section.contacts' | translate}}</h3>
        <div class="col-xs-12 col-md-6">
          <label translate="administration.contact.fields.salutation.label"></label>
          <mat-form-field class="full-width">
            <mat-select formControlName="salution">
              <mat-option *ngFor="let list of clientLk" [value]="list.value">
                {{list.text}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="row">
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.firstname.label" required></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="firstname">
              <mat-error >{{'form.errors.required' | translate}}</mat-error>
            </mat-form-field>
          </div>
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.lastname.label" required></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="lastname">
              <mat-error >{{'form.errors.required' | translate}}</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.position.label" required></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="position">
              <mat-error >{{'form.errors.required' | translate}}</mat-error>
            </mat-form-field>
          </div>
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.department.label"></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="department">
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.email.label"></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="email">
            </mat-form-field>
          </div>
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.phone.label"></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="phoneno">
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12 col-md-6">
            <label translate="administration.contact.fields.data.label"></label>
            <mat-form-field class="full-width">
              <input matInput formControlName="information">
            </mat-form-field>
          </div>
        </div>
        <div class="form-group col-sm-offset-6 col-xs-12">
          <a
            mat-stroked-button
            color="primary"
            (click)="addcontact()"
          >{{ "administration.client.buttons.delete-contact" | translate }}
          </a>
        </div>
      </div>
  <div class="form-group col-sm-offset-6 col-xs-12">
    <a
      *ngIf="!showContact"
      mat-stroked-button
      color="primary"
      (click)="addcontact()"
    >{{ "administration.client.buttons.add-contact" | translate }}
    </a>
  </div>
  <div *ngIf="paramId" class="col-xs-12 col-md start-xs">
    <button
            mat-flat-button
            color="accent"
            (click)="saveDetail(Deploy.value)"
    >{{ "administration.orders.buttons.update" | translate }}
    </button>
    <a
      mat-stroked-button
      color="primary"
      (click)="navigateToDetail()"
    >{{ "administration.orders.buttons.cancel" | translate }}
    </a>
  </div>
    <div *ngIf="!paramId">
      <button
              mat-flat-button
              color="accent"
              (click)="add(Deploy.value)"
      >{{ "administration.site.buttons.create" | translate }}
      </button>
      <a
        mat-stroked-button
        color="primary"
        [routerLink]="['/administration/sites']"
      >{{ "administration.orders.buttons.cancel" | translate }}
      </a>
    </div>

  <div class="row" style="margin-top: 20px" *ngIf="paramId">
    <div class="col-xs-12">
      <h4 translate="administration.site-clients.table.contactName"></h4>
    </div>
  </div>
  <div class="table-inner-wrapper col-xs" *ngIf="paramId">
    <table
      mat-table
      class="search-table"
      [dataSource]="Client"
    >
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>
          {{ "administration.site-clients.table.name" | translate }}
        </th>
        <td mat-cell *matCellDef="let row">
          {{row?.name}}
        </td>
      </ng-container>
      <ng-container matColumnDef="contactName">
        <th mat-header-cell *matHeaderCellDef>
          {{ "administration.site-clients.table.contactName" | translate }}
        </th>
        <td mat-cell *matCellDef="let row">
          {{row?.client_site_remarks}}
        </td>
      </ng-container>
      <ng-container matColumnDef="client_site_remarks">
        <th mat-header-cell *matHeaderCellDef >
          {{ "administration.site-clients.table.client_site_remarks" | translate }}
        </th>
        <td mat-cell *matCellDef="let row">
          {{row?.fullName}}
        </td>
      </ng-container>
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row" class="action">
          <button
            mat-icon-button
            color="accent"
            [matMenuTriggerFor]="subMenu"
            (click)="$event.stopPropagation()"
          >
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <mat-menu #subMenu="matMenu" xPosition="before">
            <button mat-menu-item (click)="open()">
              {{ "administration.client.contacts.table.actions.details" | translate }}
            </button>
            <button mat-menu-item (click)="deleteFieldClient(row)">
              {{ "administration.client.contacts.table.actions.remove" | translate }}
            </button>
          </mat-menu>
        </td>
      </ng-container>
      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns;"
      ></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <app-paginator *ngIf="paramId && Client?.length"
                   [disabled]="loading$ | async"
                   hidePageSize="true"
                   showFirstLastButtons="true"
                   [length]="paginator?.total"
                   [pageIndex]="paginator?.current_page - 1"
                   (page)="pageChange($event)">

    </app-paginator>
  </div>
    <div class="col-xs" *ngIf="this.paramId && !Client?.length">
      <div class="alert alert-info text-center">
        {{ "ui.list-table.default.no-records" | translate }}
      </div>
    </div>
  <div *ngIf="paramId">
    <div *ngIf="showClient">
      <fieldset>
      <div class="row">
        <div class="col-xs-12 col-md-6" *ngIf="!Deploy.value.client_id1">
          <mat-form-field class="full-width">
            <mat-label>{{ 'administration.site-client.fields.client.label' | translate }}</mat-label>
            <mat-select [(ngModel)]="customer" formControlName="client_id1" (selectionChange)="EditData()">
              <mat-option *ngFor="let c of Customer" [value]="c">{{c.name}}</mat-option>
            </mat-select>
            <mat-hint translate="administration.site-client.fields.client.placeholder"></mat-hint>
          </mat-form-field>
        </div>
        <div class="col-xs-12 col-md-6" *ngIf="customer && Deploy?.value?.client_id1">
          <label>{{ 'administration.site-client.fields.client.label' | translate }}</label>
          <input matInput  readonly>{{customer?.name}}
        </div>
        <div class="col-xs-12 col-md-6" *ngIf="customer">
          <mat-form-field class="full-width">
            <mat-label>{{ 'administration.site-client.fields.contact.label' | translate }}</mat-label>
            <mat-select formControlName="contact_id1">
              <mat-option *ngFor="let data of contactData" value="{{data?.value}}">
                {{ data?.text}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-md-6" *ngIf="customer">
          <mat-form-field class="full-width">
            <label>{{ 'administration.site-client.fields.description.label' | translate }}</label>
            <input matInput formControlName="description">
          </mat-form-field>
        </div>
        <div class="col-xs-12 col-md-6" *ngIf="customer">
          <label translate="administration.site-client.fields.data.label"></label>
          <mat-form-field class="full-width">
            <input matInput formControlName="data">
          </mat-form-field>
        </div>
      </div>
      </fieldset>

      <div class="col-xs-12 col-md start-xs">
        <button
          mat-flat-button
          color="accent"
          (click)="saveData(Deploy.value)"

        >{{ "administration.site-client.buttons.save" | translate }}
        </button>
        <button
          mat-stroked-button
          color="primary"
          (click)="open()"
        >{{ "administration.site-clients.table.actions.remove" | translate }}
        </button>
      </div>
    </div>
  </div>
  <div class="col-xs-12 col-md start-xs" *ngIf="paramId && !showClient">
    <button
      mat-flat-button
      color="accent"
      (click)="addfield()"
    >{{ "administration.site-clients.buttons.add" | translate }}
    </button>
  </div>
  </form>
</div>
